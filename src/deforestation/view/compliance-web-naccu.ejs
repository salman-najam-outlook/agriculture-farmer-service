<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Complicance Report" />
    <meta name="generator" content="Hugo 0.84.0" />
    <title> Compliance Report </title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      :root {
        --bs-success: #A75300;
        --bs-success-bg-subtle: #A75300;
        --bs-font-sans-serif: 'Poppins', sans-serif;
      }
      .bg-success {
        background-color: #A75300 !important;
      }
      html {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }

      body {
        font-family: 'Poppins', sans-serif;
        font-size: 0.875rem;
        background-color: transparent;
      }
      .logo {
        max-height: 86px;
        max-width: 200px;
        object-fit: contain;
        object-position: left;
      }
      .text-lg {
        font-size: 1rem;
      }
      .text-sm {
        font-size: 0.825rem;
      }
      .text-xs {
        font-size: 0.75rem;
      }
      .object-contain {
        object-fit: contain;
      }
    </style>
  </head>
  <body>
    <header class="mt-3 mb-3">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="px-3">
          <img src="data:image/png;base64, <%= greenLogo %>" alt="NACCU" class="logo rounded-end" />
        </div>
        <div class="px-5 py-3 bg-success rounded text-white text-uppercase fw-bold">
          <%= t('message.eudr_risk_assessment', {lang}) %>
        </div>
      </div>

      <div class="container-fluid d-flex align-items-center justify-content-between bg-light py-2">
        <div class="d-flex flex-column" style="max-width: 320px">
          <span class="mb-2 text-secondary"><%= reportDetails.farmName %></span>
          <span class="fw-bold text-lg"><%= reportDetails.locationName %></span>
        </div>
        <div class="d-flex flex-column" style="max-width: 240px">
          <span class="mb-2 text-secondary"><%= t('message.assessment_no', {lang}) %></span>
          <span class="fw-bold text-lg"><%= reportDetails.reportGuid ?? '-' %></span>
        </div>
      </div>
    </header>

    <main>
      <div class="container-fluid">
        <img src="data:image/png;base64, <%= mapBase64Img %>" alt="Map Image" class="img-fluid w-100 rounded mb-3" style="max-height: 400px;" />
        <div class="row gy-2">
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.assessment_issue_date', {lang}) %></span>
            <span class="fw-bold text-lg"><%= moment(reportDetails.createdAt).format('D MMMM YYYY') %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.time_period', {lang}) %></span>
            <span class="fw-bold text-lg"
              >31 December 2020 - <%= moment(reportDetails.createdAt).format('D MMMM YYYY') %></span
            >
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farmer_id', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.farmerUUID ? reportDetails.farmerUUID : '-' %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farmer_name', {lang}) %></span>
            <span class="fw-bold text-lg"
              ><%= reportDetails.farmerName %> <%= reportDetails.farm?.userAssoc?.lastName %></span
            >
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farmer_registration_id', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.farmerRegistrationId %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_id', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.farmUUID %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_name', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.farmName %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_registration_id', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.farmRegistrationId %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_address', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.locationName %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_latitude', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails?.centerLatitude %></span>
          </div>
          <div class="col-4 d-flex flex-column">
            <span class="mb-1 text-secondary"><%= t('message.farm_longitude', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails?.centerLongitude %></span>
          </div>
        </div>
      </div>
      <div style="page-break-before: always;"></div>
      <div class="pt-3">
        <div class="container-fluid d-flex align-items-center justify-content-between bg-light py-2">
          <div class="d-flex flex-column" style="max-width: 320px">
            <span class="mb-2 text-secondary"><%= reportDetails.farmName %></span>
            <span class="fw-bold text-lg"><%= reportDetails.locationName %></span>
          </div>
          <div class="d-flex flex-column" style="max-width: 240px">
            <span class="mb-2 text-secondary"><%= t('message.assessment_no', {lang}) %></span>
            <span class="fw-bold text-lg"><%= reportDetails.reportGuid ?? '-' %></span>
          </div>
        </div>
        <div class="container-fluid">
          <table class="fw-bold w-100 my-5">
            <thead class="text-white">
              <tr>
                <th class="rounded-start bg-success py-2 px-2"><%= t('message.deforestation_probability', {lang}) %></th>
                <th class="bg-success py-2 px-2"><%= t('message.color_code', {lang}) %></th>
                <th class="bg-success py-2 px-2 text-end"><%= t('message.geofence_area', {lang}) %></th>
                <th class="rounded-end bg-success py-2 px-2 text-end">
                  <%= t('message.percentage_of_geofence_area', {lang}) %>
                </th>
              </tr>
            </thead>
            <tbody>
              <% for(const metric of reportDetails.metrics) { %>
              <tr>
                <td class="py-2 px-2"><%= t('message.' + snakeCase(metric.label.replace('/', ' Or ')), {lang}) %></td>
                <td class="py-2 px-2">
                  <div class="d-flex justify-content-between align-items-center flex-nowrap">
                    <span><%= t('message.' + snakeCase(metric.colorName), { lang }) %></span>
                    <span
                      class="d-block border rounded"
                      style="height: 20px; width: 20px; background-color: <%= metric.colorCode %>"
                    ></span>
                  </div>
                </td>
                <td class="py-2 px-2 text-end">
                  <%= parseFloat(metric.area.toFixed(3)) %> <%= userUnit.abbvr.toUpperCase() %>
                </td>
                <td class="py-2 px-2 text-end"><%= parseFloat(metric.percent.toFixed(3)) %>%</td>
              </tr>
              <% } %>
            </tbody>
            <tfoot class="text-end text-white">
              <tr>
                <td colspan="2" class="bg-success-subtle rounded-start py-2 px-2">
                  <%= t('message.total_geofence_area', {lang}) %>
                </td>
                <td class="bg-success-subtle py-2 px-2">
                  <%= parseFloat(reportDetails.totalArea.toFixed(3)) %> <%= userUnit.abbvr.toUpperCase() %>
                </td>
                <td class="bg-success-subtle rounded-end py-2 px-2">100%</td>
              </tr>
            </tfoot>
          </table>

          <div class="flex flex-column">
            <div class="text-center fw-bold py-2 px-2 rounded mb-2 w-full bg-success text-white">
              <%= t('message.overall_deforestation_prob', {lang}) %>
            </div>
            <div class="text-center d-flex align-items-center justify-content-center">
              <div
                class="border rounded-pill px-2 py-2 fw-bold"
                style="border-color: currentColor !important; color: <%= (reportDetails.originalOverallProb || reportDetails.overallProb || '').toLowerCase().includes('zero') ? '#000000' : reportDetails.overallProbColorCode %>;"
              >
                <%= (typeof (reportDetails.originalOverallProb || reportDetails.overallProb) === 'string' && (reportDetails.originalOverallProb || reportDetails.overallProb).trim() !== '') ?
                t(`message.${(reportDetails.originalOverallProb || reportDetails.overallProb).split(/[\/\s]/).join("_").toLowerCase()}`, {lang}) : 'N/A' %>
              </div>
            </div>
          </div>

          <div class="text-center mt-5">
            <p class="text-sm mb-2"><%= t('message.blockchain_assessment_content', {lang}) %></p>
            <div class="d-flex flex-column mb-2">
              <span class="text-xs mb-2"><%= t('message.blockchain_certificate', {lang}) %></span>
              <div class="mb-2">
                <a href="<%= reportDetails.etherScanLink %>" target="_blank" class="text-decoration-none rounded text-xs fw-bold px-4 py-2 bg-success text-white">
                  <%= reportDetails.transactionHash %>
                </a>
              </div>
              <span class="text-xs"><%= t('message.blockchain_copy_link', {lang}) %></span>
            </div>
            <img src="<%= reportDetails.qrCode %>" alt="QR Code" />
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
